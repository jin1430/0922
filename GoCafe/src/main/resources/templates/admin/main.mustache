{{> layout/header}}

<main class="cg-container" style="padding:24px 0">
    <h1 class="cg-title">관리자 페이지</h1>

    <div class="cg-mypage-grid" id="admin-layout">
        <!-- 좌측 내비 -->
        <aside>
            <nav class="cg-sidenav">
                <a href="/admin" class="is-active">대시보드</a>
                <a href="#section-cafes">카페 관리</a>
            </nav>
        </aside>

        <!-- 우측 본문 -->
        <section style="display:flex;flex-direction:column;gap:24px">

            <!-- ====== 카페 관리 (승인/거절만) ====== -->
            <article id="section-cafes" class="cg-panel">
                <header class="cg-panel__head">
                    <div>
                        <div class="cg-eyebrow">카페 관리</div>
                        <h2 class="cg-panel__title">승인 대기 목록</h2>
                    </div>
                </header>

                <div class="cg-panel__body">
                    <table class="cg-table" style="width:100%">
                        <thead>
                        <tr>
                            <th style="width:80px">ID</th>
                            <th>이름</th>
                            <th>주소</th>
                            <th style="width:220px">액션</th>
                        </tr>
                        </thead>
                        <tbody>
                        {{#pendingCafes}}
                            <tr>
                                <td>{{id}}</td>
                                <td><a href="/cafes/{{id}}" target="_blank" rel="noopener">{{name}}</a></td>
                                <td>{{address}}</td>
                                <td style="display:flex;gap:8px">
                                    <!-- 증빙서: 링크는 항상 id로 고정, bizDoc 없을 때만 숨김 -->
                                    <a href="/admin/cafes/{{id}}/bizdoc"
                                       class="cg-btn-outline"
                                        {{^bizDoc}}style="display:none" aria-disabled="true"{{/bizDoc}}>
                                        증빙서
                                    </a>

                                    <button class="cg-btn" data-post="/admin/cafes/{{id}}/approve">승인</button>
                                    <button class="cg-btn-outline is-danger" data-post="/admin/cafes/{{id}}/reject">거절</button>
                                </td>
                            </tr>
                        {{/pendingCafes}}

                        {{^pendingCafes}}
                            <tr>
                                <td colspan="4" style="text-align:center;color:#64748b">
                                    승인 대기 중인 카페가 없습니다.
                                </td>
                            </tr>
                        {{/pendingCafes}}
                        </tbody>
                    </table>
                </div>
            </article>

        </section>
    </div>
</main>

{{> layout/footer}}

<!-- JWT 전송(쿠키면 자동), 로컬스토리지면 Authorization 헤더 추가 -->
<script>
    async function postWithJwt(url) {
      const headers = {};
      const token = localStorage.getItem('accessToken'); // 프로젝트 키에 맞게 조정 가능
      if (token) headers['Authorization'] = `Bearer ${token}`;
      const res = await fetch(url, { method: 'POST', headers });
      if (!res.ok) throw new Error(res.status + ' ' + (await res.text()).slice(0,200));
      return res;
    }

    document.addEventListener('click', async (e) => {
      const btn = e.target.closest('[data-post]');
      if (!btn) return;
      e.preventDefault();
      btn.disabled = true;
      try {
        await postWithJwt(btn.dataset.post);
        location.reload();
      } catch (err) {
        alert('요청 실패: ' + err.message);
      } finally {
        btn.disabled = false;
      }
    });
</script>
