{{>layout/header}}

<main class="cg-container">
    <!-- ===== Hero ===== -->
    <section class="cg-hero">
        {{#cafe}}
            <div class="cg-hero__inner">
                <!-- 좌측: 메인 사진 -->
                <div class="cg-hero__left">
                    <div class="cg-hero__imgwrap">
                        {{#mainPhoto}}
                            <img class="cg-card__img" src="{{mainPhoto.cafePhotoUrl}}" alt="{{cafeName}}"
                                 onerror="this.style.display='none'; this.parentElement.classList.add('cg-noimg');">
                        {{/mainPhoto}}
                        {{^mainPhoto}}
                            <img class="cg-card__img" src="/images/placeholder-cafe.jpg" alt="이미지 없음"
                                 onerror="this.style.display='none'; this.parentElement.classList.add('cg-noimg');">
                        {{/mainPhoto}}
                    </div>
                </div>

                <!-- 우측: 제목/메타/정보/태그/버튼 -->
                <div class="cg-hero__right">
                    <h1 class="cg-title" style="margin:0 0 8px 0">{{cafeName}}</h1>

                    <div class="cg-hero__meta" style="margin-bottom:12px;display:flex;gap:8px;color:#64748b">
                        <span>조회수 {{cafeViews}}</span><span class="cg-dot">·</span>
                        {{#cafeDateFmt}}<span>등록 {{cafeDateFmt}}</span>{{/cafeDateFmt}}
                        {{^cafeDateFmt}}<span>등록 {{cafeDate}}</span>{{/cafeDateFmt}}
                        <span class="cg-dot">·</span><span>{{cafeCode}}</span>
                    </div>

                    <div class="cg-info-plain">
                        <dl class="cg-dl">
                            <div class="cg-dl__row"><dt>주소</dt><dd>{{cafeAddress}}</dd></div>
                            <div class="cg-dl__row"><dt>전화번호</dt><dd>{{cafeNumber}}</dd></div>
                        </dl>
                    </div>

                    <div class="cg-chips" style="display:flex;flex-wrap:wrap;gap:8px;margin:12px 0">
                        {{#cafeTags}}
                            <button class="cg-chip" data-category="{{tagCategoryCode}}" data-tag="{{tagCode}}">{{tagCode}}</button>
                        {{/cafeTags}}
                        {{^cafeTags}}<span class="cg-empty">등록된 태그가 없어요.</span>{{/cafeTags}}
                    </div>

                    <div class="cg-actions" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px">
                        <a class="cg-btn-outline" href="tel:{{cafeNumber}}">전화하기</a>
                        <a class="cg-btn-outline" target="_blank"
                           href="https://map.kakao.com/link/to/{{cafeName}},{{cafeLat}},{{cafeLon}}">길찾기</a>
                        {{#isLoggedIn}}<a class="cg-btn" href="/reviews/new?cafeId={{cafeId}}">후기 작성</a>{{/isLoggedIn}}
                        {{#isOwner}}
                            <a class="cg-btn-outline" href="/cafes/{{cafeId}}/edit">정보 수정</a>
                            <form method="post" action="/cafes/{{cafeId}}/delete" style="display:inline">
                                {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
                                <button class="cg-btn-outline" type="submit" onclick="return confirm('삭제하시겠어요?')">삭제</button>
                            </form>
                        {{/isOwner}}
                    </div>
                </div>
            </div>
        {{/cafe}}
    </section>

    <!-- ===== 영업 정보 / 소개 ===== -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>영업 정보</h3></div>
        <div class="cg-grid2">
            <div class="cg-card"><div class="cg-card__body">
                {{#info}}
                    <dl class="cg-dl">
                        <div class="cg-dl__row"><dt>오픈</dt><dd>{{cafeOpenTime}}</dd></div>
                        <div class="cg-dl__row"><dt>마감</dt><dd>{{cafeCloseTime}}</dd></div>
                        <div class="cg-dl__row"><dt>휴무일</dt><dd>{{cafeHoliday}}</dd></div>
                    </dl>
                {{/info}}
                {{^info}}<div class="cg-empty">영업 정보가 아직 없어요.</div>{{/info}}
            </div></div>

            <div class="cg-card"><div class="cg-card__body">
                {{#info}}
                    {{#cafeNotice}}<div class="cg-note"><strong>공지</strong> {{cafeNotice}}</div>{{/cafeNotice}}
                    {{#cafeInfo}}<p class="cg-desc">{{cafeInfo}}</p>{{/cafeInfo}}
                    {{^cafeNotice}}{{^cafeInfo}}<div class="cg-empty">소개/공지 정보가 아직 없어요.</div>{{/cafeInfo}}{{/cafeNotice}}
                {{/info}}
                {{^info}}<div class="cg-empty">소개/공지 정보가 아직 없어요.</div>{{/info}}
            </div></div>
        </div>
    </section>

    <!-- ===== 위치(지도) ===== -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>위치</h3></div>
        <div class="cg-card"><div class="cg-card__body">
            {{#cafe}}
                <div id="map" class="cg-map" data-lat="{{cafeLat}}" data-lon="{{cafeLon}}" data-name="{{cafeName}}">
                    <div class="cg-empty">지도가 여기에 표시됩니다.</div>
                </div>
            {{/cafe}}
        </div></div>
    </section>

    <!-- ===== 메뉴 ===== -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>메뉴</h3><a class="cg-link" href="/cafes/{{cafe.cafeId}}/menu">전체 메뉴</a></div>
        <ul class="cg-card-grid">
            {{#menus}}
                <li class="cg-card">
                    <div class="cg-card__imgwrap">
                        <img class="cg-card__img" src="{{menuPhoto}}" alt="{{menuName}}"
                             onerror="this.style.display='none'; this.parentElement.classList.add('cg-noimg');" />
                    </div>
                    <div class="cg-card__body">
                        <div class="cg-card__title">{{menuName}}</div>
                        <div class="cg-card__meta">{{menuPrice}}</div>
                    </div>
                </li>
            {{/menus}}
            {{^menus}}<li class="cg-empty">등록된 메뉴가 없어요.</li>{{/menus}}
        </ul>
    </section>

    <!-- ===== 방문자 리뷰 ===== -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>방문자 리뷰</h3>{{#isLoggedIn}}<a class="cg-link" href="/reviews/new?cafeId={{cafe.cafeId}}">후기 작성</a>{{/isLoggedIn}}</div>
        <ul class="cg-feed">
            {{#reviews}}
                <li class="cg-feed__item">
                    <p class="cg-feed__text">{{reviewContent}}</p>
                    <div class="cg-feed__meta">
                        <span>{{reviewDate}}</span>
                        <span>좋아요 {{reviewGood}} / 아쉬워요 {{reviewBad}}</span>
                        {{#memberNickname}}<span class="cg-dot">·</span><span>{{memberNickname}}</span>{{/memberNickname}}
                    </div>
                </li>
            {{/reviews}}
            {{^reviews}}<li class="cg-empty">아직 리뷰가 없네요.</li>{{/reviews}}
        </ul>
    </section>

    <!-- ===== 리뷰 작성 ===== -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>리뷰 작성</h3></div>
        <div class="cg-card">
            {{#isLoggedIn}}
                <form class="cg-card__body" method="post" action="/reviews/new" enctype="multipart/form-data">
                    {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
                    <input type="hidden" name="cafeId" value="{{cafe.cafeId}}"/>

                    <div class="cg-field" style="display:grid;row-gap:8px">
                        <label for="reviewContent" class="cg-label">내용</label>
                        <textarea id="reviewContent" name="reviewContent" class="cg-input" rows="4" placeholder="방문 후기를 남겨주세요." required></textarea>
                    </div>

                    <div class="cg-field" style="margin-top:12px;display:grid;row-gap:8px">
                        <label class="cg-label">사진 (선택)</label>
                        <input type="file" name="photos" accept="image/*" multiple>
                        <div id="photoPreview" class="cg-preview"></div>
                        <small class="cg-help">최대 5장, 이미지당 10MB 이하 권장</small>
                    </div>

                    <div class="cg-actions" style="justify-content:flex-end;margin-top:16px">
                        <button type="submit" class="cg-btn">등록</button>
                    </div>
                </form>
            {{/isLoggedIn}}
            {{^isLoggedIn}}
                <div class="cg-card__body">
                    <div class="cg-empty">
                        로그인 후 작성하실 수 있어요.
                        <a class="cg-link" href="/login?redirect=/cafes/{{cafe.cafeId}}">로그인하기</a>
                    </div>
                </div>
            {{/isLoggedIn}}
        </div>
    </section>

    <!-- ===== 사진 갤러리 ===== -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>사진</h3></div>
        <ul class="cg-card-grid">
            {{#cafePhotos}}
                <li class="cg-card">
                    <div class="cg-card__imgwrap">
                        <img class="cg-card__img" src="{{cafePhotoUrl}}" alt="{{cafe.cafeName}}"
                             onerror="this.style.display='none'; this.parentElement.classList.add('cg-noimg');" />
                    </div>
                </li>
            {{/cafePhotos}}
            {{^cafePhotos}}<li class="cg-empty">등록된 사진이 없어요.</li>{{/cafePhotos}}
        </ul>
    </section>

    <!-- ===== 모바일 플로팅 액션 ===== -->
    <div class="cg-fab">
        {{#cafe}}
            <a class="cg-fab__btn" href="tel:{{cafeNumber}}">전화</a>
            <a class="cg-fab__btn" target="_blank" href="https://map.kakao.com/link/to/{{cafeName}},{{cafeLat}},{{cafeLon}}">길찾기</a>
            {{#isLoggedIn}}<a class="cg-fab__btn" href="/reviews/new?cafeId={{cafeId}}">후기</a>{{/isLoggedIn}}
        {{/cafe}}
    </div>
</main>

{{>layout/footer}}