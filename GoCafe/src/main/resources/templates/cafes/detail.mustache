{{>layout/header}}

<main class="cg-container">

    <!-- 헤더/히어로: 대표 이미지 + 타이틀 -->
    <section class="cg-hero cg-hero--one">
        {{#cafe}}
            <div class="cg-hero__inner">
                <div class="cg-hero__left">
                    <h1 class="cg-title">{{cafeName}}</h1>
                    <div class="cg-hero__meta">
                        <span>조회수 {{cafeViews}}</span>
                        <span class="cg-dot">·</span>
                        {{#cafeDateFmt}}<span>등록 {{cafeDateFmt}}</span>{{/cafeDateFmt}}
                        {{^cafeDateFmt}}<span>등록 {{cafeDate}}</span>{{/cafeDateFmt}}
                        <span class="cg-dot">·</span>
                        <span>{{cafeCode}}</span>
                    </div>

                    <!-- 태그 칩 -->
                    <div class="cg-chips">
                        {{#cafeTags}}
                            <button class="cg-chip" data-category="{{tagCategoryCode}}" data-tag="{{tagCode}}">
                                {{tagCode}}
                            </button>
                        {{/cafeTags}}
                        {{^cafeTags}}<span class="cg-empty">등록된 태그가 없어요.</span>{{/cafeTags}}
                    </div>

                    <!-- 주요 액션 -->
                    <div class="cg-actions">
                        <a class="cg-btn-outline" href="tel:{{cafeNumber}}">전화하기</a>
                        <a class="cg-btn-outline" target="_blank"
                           href="https://map.kakao.com/link/to/{{cafeName}},{{cafeLat}},{{cafeLon}}">
                            길찾기
                        </a>
                        {{#isLoggedIn}}
                            <a class="cg-btn" href="/reviews/new?cafeId={{cafeId}}">후기 작성</a>
                        {{/isLoggedIn}}
                        {{#isOwner}}
                            <a class="cg-btn-outline" href="/cafes/{{cafeId}}/edit">정보 수정</a>
                            <form method="post" action="/cafes/{{cafeId}}/delete" style="display:inline">
                                {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
                                <button class="cg-btn-outline" type="submit" onclick="return confirm('삭제하시겠어요?')">삭제</button>
                            </form>
                        {{/isOwner}}
                    </div>
                </div>

                <div class="cg-hero__right">
                    <div class="cg-card__imgwrap cg-hero__imgwrap">
                        <img class="cg-card__img" src="{{cafePhoto}}" alt="{{cafeName}}"
                             onerror="this.style.display='none'; this.parentElement.classList.add('cg-noimg');"/>
                    </div>
                </div>
            </div>
        {{/cafe}}
    </section>

    <!-- 기본 정보 -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>기본 정보</h3></div>
        <div class="cg-card">
            <div class="cg-card__body">
                {{#cafe}}
                    <dl class="cg-dl">
                        <div class="cg-dl__row">
                            <dt>주소</dt>
                            <dd>{{cafeAddress}}</dd>
                        </div>
                        <div class="cg-dl__row">
                            <dt>전화번호</dt>
                            <dd>{{cafeNumber}}</dd>
                        </div>
                        <div class="cg-dl__row">
                            <dt>좌표</dt>
                            <dd>{{cafeLat}}, {{cafeLon}}</dd>
                        </div>
                    </dl>
                {{/cafe}}
            </div>
        </div>
    </section>

    <!-- 영업 정보 -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>영업 정보</h3></div>
        <div class="cg-grid2">
            <div class="cg-card">
                <div class="cg-card__body">
                    {{#info}}
                        <dl class="cg-dl">
                            <div class="cg-dl__row">
                                <dt>오픈</dt>
                                <dd>{{cafeOpenTime}}</dd>
                            </div>
                            <div class="cg-dl__row">
                                <dt>마감</dt>
                                <dd>{{cafeCloseTime}}</dd>
                            </div>
                            <div class="cg-dl__row">
                                <dt>휴무일</dt>
                                <dd>{{cafeHoliday}}</dd>
                            </div>
                        </dl>
                    {{/info}}
                    {{^info}}<div class="cg-empty">영업 정보가 아직 없어요.</div>{{/info}}
                </div>
            </div>

            <div class="cg-card">
                <div class="cg-card__body">
                    {{#info}}
                        {{#cafeNotice}}<div class="cg-note"><strong>공지</strong> {{cafeNotice}}</div>{{/cafeNotice}}
                        {{#cafeInfo}}<p class="cg-desc">{{cafeInfo}}</p>{{/cafeInfo}}
                        {{^cafeNotice}}{{^cafeInfo}}<div class="cg-empty">소개/공지 정보가 아직 없어요.</div>{{/cafeInfo}}{{/cafeNotice}}
                    {{/info}}
                    {{^info}}<div class="cg-empty">소개/공지 정보가 아직 없어요.</div>{{/info}}
                </div>
            </div>
        </div>
    </section>

    <!-- 지도 -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>위치</h3></div>
        <div class="cg-card">
            <div class="cg-card__body">
                {{#cafe}}
                    <div id="map" class="cg-map" data-lat="{{cafeLat}}" data-lon="{{cafeLon}}" data-name="{{cafeName}}">
                        <!-- 지도는 별도 JS에서 data-*를 읽어 렌더링 -->
                        <div class="cg-empty">지도가 여기에 표시됩니다.</div>
                    </div>
                {{/cafe}}
            </div>
        </div>
    </section>

    <!-- 메뉴 -->
    <section class="cg-section">
        <div class="cg-section__head">
            <h3>메뉴</h3>
            <a class="cg-link" href="/cafes/{{cafe.cafeId}}/menu">전체 메뉴</a>
        </div>

        <ul class="cg-card-grid">
            {{#menus}}
                <li class="cg-card">
                    <div class="cg-card__imgwrap">
                        <img class="cg-card__img" src="{{menuPhoto}}" alt="{{menuName}}"
                             onerror="this.style.display='none'; this.parentElement.classList.add('cg-noimg');"/>
                    </div>
                    <div class="cg-card__body">
                        <div class="cg-card__title">{{menuName}}</div>
                        <div class="cg-card__meta">{{menuPrice}}</div>
                    </div>
                </li>
            {{/menus}}
            {{^menus}}<li class="cg-empty">등록된 메뉴가 없어요.</li>{{/menus}}
        </ul>
    </section>

    <!-- 리뷰 -->
    <section class="cg-section">
        <div class="cg-section__head">
            <h3>방문자 리뷰</h3>
            {{#isLoggedIn}}<a class="cg-link" href="/reviews/new?cafeId={{cafe.cafeId}}">후기 작성</a>{{/isLoggedIn}}
        </div>

        <ul class="cg-feed">
            {{#reviews}}
                <li class="cg-feed__item">
                    <p class="cg-feed__text">{{reviewContent}}</p>
                    <div class="cg-feed__meta">
                        <span>{{reviewDate}}</span>
                        <span>좋아요 {{reviewGood}} / 아쉬워요 {{reviewBad}}</span>
                        {{#memberNickname}}<span class="cg-dot">·</span><span>{{memberNickname}}</span>{{/memberNickname}}
                    </div>
                </li>
            {{/reviews}}
            {{^reviews}}<li class="cg-empty">아직 리뷰가 없네요.</li>{{/reviews}}
        </ul>

        <!-- 리뷰 작성 -->
        <section class="cg-section">
            <div class="cg-section__head"><h3>리뷰 작성</h3></div>

            <div class="cg-card">
                {{#isLoggedIn}}
                    <form class="cg-card__body" method="post" action="/reviews/new" enctype="multipart/form-data">
                        {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
                        <input type="hidden" name="cafeId" value="{{cafe.cafeId}}"/>

                        <!-- 댓글(내용) -->
                        <div class="cg-field" style="display:grid;row-gap:8px">
                            <label for="reviewContent" class="cg-label">내용</label>
                            <textarea id="reviewContent" name="reviewContent" class="cg-input" rows="4"
                                      placeholder="방문 후기를 남겨주세요." required></textarea>
                        </div>

                        <!-- 사진 추가 -->
                        <div class="cg-field" style="margin-top:12px;display:grid;row-gap:8px">
                            <label class="cg-label">사진 (선택)</label>

                            <input type="file" name="photos" accept="image/*" multiple>


                            <!-- 미리보기 -->
                            <div id="photoPreview" class="cg-preview"></div>
                            <small class="cg-help">최대 5장, 이미지당 10MB 이하 권장</small>
                        </div>

                        <!-- 제출 -->
                        <div class="cg-actions" style="justify-content:flex-end;margin-top:16px">
                            <button type="submit" class="cg-btn">등록</button>
                        </div>
                    </form>
                {{/isLoggedIn}}

                {{^isLoggedIn}}
                    <div class="cg-card__body">
                        <div class="cg-empty">
                            로그인 후 작성하실 수 있어요.
                            <a class="cg-link" href="/login?redirect=/cafes/{{cafe.cafeId}}">로그인하기</a>
                        </div>
                    </div>
                {{/isLoggedIn}}
            </div>
        </section>
    </section>

    <!-- 하단 플로팅 액션 (모바일 편의) -->
    <div class="cg-fab">
        {{#cafe}}
            <a class="cg-fab__btn" href="tel:{{cafeNumber}}">전화</a>
            <a class="cg-fab__btn" target="_blank"
               href="https://map.kakao.com/link/to/{{cafeName}},{{cafeLat}},{{cafeLon}}">길찾기</a>
            {{#isLoggedIn}}<a class="cg-fab__btn" href="/reviews/new?cafeId={{cafeId}}">후기</a>{{/isLoggedIn}}
        {{/cafe}}
    </div>

</main>

{{>layout/footer}}
