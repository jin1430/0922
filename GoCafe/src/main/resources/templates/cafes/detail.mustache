{{>layout/header}}

<main class="cg-container" {{#cafe}}data-cafe-id="{{id}}"{{/cafe}}>

    <!-- ===== Hero (좌: 메인 사진 / 우: 정보) ===== -->
    <section class="cg-hero">
        {{#cafe}}
            <div class="cg-hero__inner">
                <!-- 좌측: 메인 사진 -->
                <div class="cg-hero__left">
                    <div class="cg-hero__imgwrap">
                        {{#mainPhoto}}
                            <img class="cg-card__img" src="{{mainPhoto}}" alt="{{name}}"
                                 onerror="this.style.display='none'; this.parentElement.classList.add('cg-noimg');">
                        {{/mainPhoto}}
                        {{^mainPhoto}}
                            <img class="cg-card__img" src="/images/placeholder-cafe.jpg" alt="이미지 없음"
                                 onerror="this.style.display='none'; this.parentElement.classList.add('cg-noimg');">
                        {{/mainPhoto}}
                    </div>
                </div>

                <!-- 우측: 제목/메타/정보/태그/버튼 -->
                <div class="cg-hero__right">
                    <h1 class="cg-title" style="margin:0 0 8px 0">{{name}}</h1>

                    <div class="cg-hero__meta" style="margin-bottom:12px;display:flex;gap:8px;color:#64748b">
                        {{#views}}<span>조회수 {{views}}</span>{{/views}}{{^views}}<span>조회수 0</span>{{/views}}
                        <span class="cg-dot">·</span>
                        {{#dateFmt}}<span>등록 {{dateFmt}}</span>{{/dateFmt}}{{^dateFmt}}<span>등록 {{date}}</span>{{/dateFmt}}
                        <span class="cg-dot">·</span>
                        <span>좋아요 {{cafeGood}} / 아쉬워요 {{cafeBad}}</span>
                    </div>

                    <div class="cg-info-plain">
                        <dl class="cg-dl">
                            <div class="cg-dl__row"><dt>주소</dt><dd>{{address}}</dd></div>
                            <div class="cg-dl__row"><dt>전화번호</dt><dd>{{number}}</dd></div>
                            <div class="cg-dl__row"><dt>좌표</dt><dd>{{lat}}, {{lon}}</dd></div>
                        </dl>
                    </div>

                    <!-- 태그 칩 -->
                    <div class="cg-chips" style="display:flex;flex-wrap:wrap;gap:8px;margin:12px 0">
                        {{#cafeTags}}
                            <button class="cg-chip" data-category="{{categoryCode}}" data-tag="{{code}}">
                                {{code}}{{#count}}<small class="cg-badge">{{count}}</small>{{/count}}
                            </button>
                        {{/cafeTags}}
                        {{^cafeTags}}<span class="cg-empty">등록된 태그가 없어요.</span>{{/cafeTags}}
                    </div>

                    <!-- 주요 액션 -->
                    <div class="cg-actions" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:8px">
                        <a class="cg-btn-outline" href="tel:{{number}}">전화하기</a>
                        <a class="cg-btn-outline" target="_blank"
                           href="https://map.kakao.com/link/to/{{name}},{{lat}},{{lon}}">길찾기</a>

                        <a class="cg-btn"
                           href="#"
                           data-review-modal
                           data-cafe-id="{{id}}">후기 작성</a>

                        <button id="favBtn"
                                class="cg-btn-outline"
                                data-cafe-id="{{id}}"
                                data-favorited="{{isFavorited}}">
                            {{#isFavorited}}즐겨찾기 해제{{/isFavorited}}{{^isFavorited}}즐겨찾기{{/isFavorited}}
                        </button>

                        <span id="favCount" style="margin-left:6px">
              {{#favoriteCount}}즐겨찾기 {{favoriteCount}}{{/favoriteCount}}{{^favoriteCount}}즐겨찾기 0{{/favoriteCount}}
            </span>

                        {{#isOwner}}
                            <a class="cg-btn-outline" href="/cafes/{{id}}/edit">정보 수정</a>
                            <form method="post" action="/cafes/{{id}}/delete" style="display:inline">
                                {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
                                <button class="cg-btn-outline" type="submit" onclick="return confirm('삭제하시겠어요?')">삭제</button>
                            </form>
                        {{/isOwner}}
                    </div>
                </div>
            </div>
        {{/cafe}}
    </section>

    <!-- ===== 영업 정보 / 소개 ===== -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>영업 정보</h3></div>
        <div class="cg-grid2">
            <div class="cg-card"><div class="cg-card__body">
                {{#info}}
                    <dl class="cg-dl">
                        <div class="cg-dl__row"><dt>오픈</dt><dd>{{cafeOpenTime}}</dd></div>
                        <div class="cg-dl__row"><dt>마감</dt><dd>{{cafeCloseTime}}</dd></div>
                        <div class="cg-dl__row"><dt>휴무일</dt><dd>{{cafeHoliday}}</dd></div>
                    </dl>
                {{/info}}
                {{^info}}<div class="cg-empty">영업 정보가 아직 없어요.</div>{{/info}}
            </div></div>

            <div class="cg-card"><div class="cg-card__body">
                {{#info}}
                    {{#cafeNotice}}<div class="cg-note"><strong>공지</strong> {{cafeNotice}}</div>{{/cafeNotice}}
                    {{#cafeInfo}}<p class="cg-desc">{{cafeInfo}}</p>{{/cafeInfo}}
                    {{^cafeNotice}}{{^cafeInfo}}<div class="cg-empty">소개/공지 정보가 아직 없어요.</div>{{/cafeInfo}}{{/cafeNotice}}
                {{/info}}
                {{^info}}<div class="cg-empty">소개/공지 정보가 아직 없어요.</div>{{/info}}
            </div></div>
        </div>
    </section>

    <!-- ===== 위치(지도) ===== -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>위치</h3></div>
        <div class="cg-card"><div class="cg-card__body">
            {{#cafe}}
                <div id="map" class="cg-map" data-lat="{{lat}}" data-lon="{{lon}}" data-name="{{name}}">
                    <div class="cg-empty">지도가 여기에 표시됩니다.</div>
                </div>
            {{/cafe}}
        </div></div>
    </section>

    <!-- ===== 메뉴 ===== -->
    <section class="cg-section">
        <div class="cg-section__head">
            <h3>메뉴</h3>
            {{#cafe}}<a class="cg-link" href="/cafes/{{id}}/menu">전체 메뉴</a>{{/cafe}}
        </div>
        <ul class="cg-card-grid">
            {{#menus}}
                <li class="cg-card">
                    <div class="cg-card__imgwrap">
                        <img class="cg-card__img" src="{{menuPhoto}}" alt="{{menuName}}"
                             onerror="this.style.display='none'; this.parentElement.classList.add('cg-noimg');" />
                    </div>
                    <div class="cg-card__body">
                        <div class="cg-card__title">{{menuName}}</div>
                        <div class="cg-card__meta">{{menuPrice}}</div>
                    </div>
                </li>
            {{/menus}}
            {{^menus}}<li class="cg-empty">등록된 메뉴가 없어요.</li>{{/menus}}
        </ul>
    </section>

    <!-- ===== 방문자 리뷰 ===== -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>방문자 리뷰</h3></div>
        <ul class="cg-feed">
            {{#reviews}}
                <li class="cg-feed__item">
                    <p class="cg-feed__text">{{content}}</p>

                    <div class="cg-feed__photos" data-review-photos>
                        {{#photos}}
                            <img class="cg-feed__photo" src="{{photoUrl}}" alt="리뷰 사진" loading="lazy"
                                 onerror="this.style.display='none'"/>
                        {{/photos}}
                        <span class="cg-feed__photo-count" hidden></span>
                    </div>

                    <div class="cg-feed__meta">
                        <span>{{createdAtFmt}}</span>
                        <span>좋아요 {{good}} / 아쉬워요 {{bad}}</span>
                        {{#memberNickname}}<span class="cg-dot">·</span><span>{{memberNickname}}</span>{{/memberNickname}}
                    </div>
                </li>
            {{/reviews}}
            {{^reviews}}<li class="cg-empty">아직 리뷰가 없네요.</li>{{/reviews}}
        </ul>
    </section>


    <!-- ===== 사진 갤러리 (옵션: 모델에 cafePhotos 있을 때) ===== -->
    <section class="cg-section">
        <div class="cg-section__head"><h3>사진</h3></div>
        <ul class="cg-card-grid">
            {{#cafePhotos}}
                <li class="cg-card">
                    <div class="cg-card__imgwrap">
                        <img class="cg-card__img" src="{{cafePhotoUrl}}" alt="{{#cafe}}{{name}}{{/cafe}}"
                             onerror="this.style.display='none'; this.parentElement.classList.add('cg-noimg');" />
                    </div>
                </li>
            {{/cafePhotos}}
            {{^cafePhotos}}<li class="cg-empty">등록된 사진이 없어요.</li>{{/cafePhotos}}
        </ul>
    </section>

    <!-- ===== 모바일 플로팅 액션 ===== -->
    <div class="cg-fab">
        {{#cafe}}
            <a class="cg-fab__btn" href="tel:{{number}}">전화</a>
            <a class="cg-fab__btn" target="_blank" href="https://map.kakao.com/link/to/{{name}},{{lat}},{{lon}}">길찾기</a>
            <a class="cg-fab__btn" href="#" data-review-modal data-cafe-id="{{id}}">후기</a>
        {{/cafe}}
    </div>
</main>

<!-- ===========================
     모달 (리뷰 작성) – 기존 유지
     =========================== -->
<style>
    /* 모달: 기본 숨김, is-open 때만 표시 */
    .cg-modal{position:fixed;inset:0;display:none;z-index:1000}
    .cg-modal.is-open{display:grid}
    .cg-modal__backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45)}
    .cg-modal__dialog{position:relative;width:100%;height:100%;display:grid;place-items:center;padding:20px;pointer-events:none}
    .cg-modal__sheet{width:min(720px,96vw);max-height:88vh;background:#fff;border-radius:16px;overflow:auto;pointer-events:auto}
    .cg-modal__header,.cg-modal__footer{padding:16px 20px}
    .cg-modal__content{padding:0 20px 16px}
    .cg-modal__title{margin:0;font-size:20px}
    .cg-modal__close{border:0;background:transparent;font-size:28px;line-height:1;cursor:pointer;margin-left:auto}
    body.cg-modal-open{overflow:hidden}
</style>

<div id="reviewModal" class="cg-modal" aria-hidden="true" role="dialog" aria-labelledby="reviewModalTitle">
    <div class="cg-modal__backdrop" data-close-modal></div>
    <div class="cg-modal__dialog">
        <form id="reviewForm" class="cg-modal__sheet" method="post" action="/reviews/new" enctype="multipart/form-data" novalidate>
            {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
            <input type="hidden" name="cafeId" id="modalCafeId"/>

            <div class="cg-modal__header" style="display:flex;gap:8px;align-items:center">
                <h3 id="reviewModalTitle" class="cg-modal__title">리뷰 작성</h3>
                <button type="button" class="cg-modal__close" aria-label="닫기" data-close-modal>&times;</button>
            </div>

            <div class="cg-modal__content">
                <label class="cg-label">내용</label>
                <textarea name="reviewContent" class="cg-input" rows="4" placeholder="방문 후기를 남겨주세요." required maxlength="1000" autofocus></textarea>

                <div class="cg-grid2" style="margin-top:12px">
                    <div>
                        <label class="cg-label">웨이팅 시간(분)</label>
                        <input type="number" name="waitingTime" class="cg-input" min="0" placeholder="예: 15"/>
                    </div>
                    <div>
                        <label class="cg-label">누구와 갔나요?</label>
                        <select name="companionType" class="cg-input">
                            <option value="">선택</option>
                            <option value="SOLO">혼자</option>
                            <option value="FRIEND">친구</option>
                            <option value="DATE">연인</option>
                            <option value="FAMILY">가족</option>
                            <option value="BUSINESS">비즈니스</option>
                        </select>
                    </div>
                </div>

                <label class="cg-label" style="margin-top:12px">음식의 맛</label>
                <div class="cg-rating">
                    <label><input type="radio" name="taste" value="1">1</label>
                    <label><input type="radio" name="taste" value="2">2</label>
                    <label><input type="radio" name="taste" value="3" checked>3</label>
                    <label><input type="radio" name="taste" value="4">4</label>
                    <label><input type="radio" name="taste" value="5">5</label>
                </div>

                <label class="cg-label" style="margin-top:12px">전반적 만족도</label>
                <div class="cg-toggle2" role="group" aria-label="전반적 만족도">
                    <label class="cg-toggle2__btn">
                        <input type="radio" name="sentiment" value="GOOD" checked>
                        <span>좋아요</span>
                    </label>
                    <label class="cg-toggle2__btn">
                        <input type="radio" name="sentiment" value="BAD">
                        <span>아쉬워요</span>
                    </label>
                </div>

                <label class="cg-label" style="margin-top:12px">이런 점이 좋았어요 (복수선택)</label>
                <div class="cg-chips">
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="맛있어요"> 음식이 맛있어요</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="친절해요"> 친절해요</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="인테리어"> 인테리어가 멋져요</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="신선한재료"> 재료가 신선해요</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="특별한메뉴"> 특별한 메뉴가 있어요</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="기본안주"> 기본 안주가 좋아요</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="음악"> 음악이 좋아요</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="혼술"> 혼술하기 좋아요</label>
                    <label class="cg-chip"><input type="checkbox" name="likedTagCodes" value="가성비"> 가성비가 좋아요</label>
                </div>

                <label class="cg-label" style="margin-top:12px">사진 (선택)</label>
                <input type="file" id="photoInput" name="photos" accept="image/*" multiple>
                <small class="cg-help">최대 5장, 이미지당 10MB 이하 권장</small>
            </div>

            <div class="cg-modal__footer" style="display:flex;justify-content:flex-end;gap:8px">
                <button type="button" class="cg-btn-outline" data-close-modal>취소</button>
                <button type="submit" class="cg-btn">등록</button>
            </div>
        </form>
    </div>
</div>

{{>layout/footer}}